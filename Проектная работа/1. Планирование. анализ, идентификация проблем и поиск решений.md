# Анализ
Существующая система состоит из следующих компонент:  

- Internet Shop - магазин товаров. Представляет собой web-приложение в браузере клиента.
- CRM - система ведения и учета заказчиков и их заказов
- CRM API -  API для интеграции CRM в общий ландшафт
- MES - проприетарная система расчета стоимости изготовления заказа. Доступна вместе с исходным кодом, что позволяет её кастомизировать.
- MES API - API для интеграции MES в общий ландшафт
- RabbitMQ - брокер сообщений, для асинхронного обмена сообщениями
- Shop Database - база данных CRM и интернет магазина.
- MES Database - база данных MES
- S3 хранилище - объектное хранилище файлов 3D моделей.

---

Покупку изделия в магазине не рассматриваем.
Упрощенно, workflow выглядит следующим образом:  
Пользователь используя доступный MES API загружает 3D модель. Модель сохраняется в S3 хранилище и поступает на просчет стоимости в MES. 
После завершения просчета стоимости, формируется соответствующее событие для данного пользователя (заказчика). Через RabbitMQ 
данное событие поступает в CRM, где создается непосредственно заказ, который отображается в личном кабинете пользователя в 
Internet Shop. После согласования (подтверждения) заказа, он может быть выбран оператором и взят в реализацию. 
После реализации, оператор упаковывает и отправляет заказ, меняя соответствущие статусы в MES, которые отражаются через RabbitMQ в CRM.

**Текущие проблемы:**  

После добавления MES API и возможности самостоятельной загрузки данных пользователем, клиенты начали жаловаться на крайне 
выросшее время изготовления заказа, а зачастую даже полного отсутствия заказа. 
Производственная часть организации имеет запас по производственным мощностям и способна справляться с возросшей нагрузкой. 
Логично сделать вывод что "узким горлом" в процессе формирования заказа и его непосредственной реализацией стал IT-ландшафт, 
ответственный за прием, формирование и отправку готового заказа. 
Можно предположить, что интеграция CRM и MES работает не стабильно, либо не работает вовсе. То есть создание заказа в CRM, регистрация
его в MES, изменение статуса заказа в MES никак не отражается в CRM, тем самым пользователи не знают что с заказом, 
либо операторы не знают что заказ есть и его можно брать в работу.

Также наблюдаются проблемы при загрузке операторами главной страницы в MES, что приводит не только к неудобству, но и к пропуску 
операторами готовых к выполнению заказов. Это также может быть причиной того, что заказы долго, либо вообще, не выполняются.

---

Для решения имеющихся и потенциальных будущих проблем необходим качественный мониторинг всего состояния системы. 
Необходимо понимание показателей утилизации ресурсов каждым компонентом системы. 
Помимо утилизации ресурсов, необходимо понимание времени выполнения различных задач всеми компонентами системы.
Также на первых этапах анализа, необходимо выявить цепочки взаимодействия компонент между собой, для того, чтобы определить не прерываются ли интеграционные потоки на одном из узлов или частей системы. 
Доходят ли необходимые данные от одного компонента до другого.   
Для этого можно использовать распределенную трассировку, которая покажет когда, куда и что приходило и какой ответ был получен.

С точки зрения проблемы с загрузкой дашборда MES. Если фильтрация и пагинация не помогли, возможно проблема не там где её пытались исправить.
Причин может быть множество, например: большая нагрузка на MES, нагрузка на БД MES, сетевые проблемы, большой объем выборки из БД. 
Все эти причины, в совокупности с возможными другими, могут приводить к более долгим ответам на запросы и влиять на пользовательский опыт эксплуатации системы. 
В данном случае также необходим качественный мониторинг для локализации узких мест, для того, чтобы в последующем выбрать подходящее решение проблемы.

--- 

Итак, список текущих и потенциальных проблем при эксплуатации системы.
 - Нечеткая логика workflow, которая, возможно, приводит к несогласованности данных.
 - Проблемы при загрузке дашбордов.
 - Проблемы масштабирования. Одного экземпляра на каждый компонент при возрастающей нагрузке может оказаться недостаточно.
 - Проблема отсутствия какого-либо мониторинга, и как следствие непонимание текущего состояния системы.
 - Отсутствие некой единой, входной точки (Gateway API) для обработки всех входящих запросов. 

---

Для анализа и решения текущих, и потенциальных в будущем, проблем необходим внедрение качественного и показательного мониторинга.
На основе данных мониторинга команда разработки совместно с командой эксплуатации должны выработать подходы и методы решения проблем. 

На первых этапах модернизации системы необходимо внедрить мониторинг, который подразумевает сбор метрик производительности компонент, метрик производительности
аппаратных ресурсов, а также внедрить распределенную трассировку. Это позволит первое время решать точечно наиболее критичные проблемы, пока прорабатывается общая концепция будущей 
высоконагруженной архитектуры системы. 
После внедрения мониторинга и анализа метрик, можно приступать к рассмотрению вопросов масштабирования, отказоустойчивости, надежности и отзывчивости системы в целом. 
